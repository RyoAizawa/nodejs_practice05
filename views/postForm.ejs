<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>レビューを投稿する | 商品レビュー</title>
        <meta name="description" content="">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.0/css/bootstrap-reboot.min.css">
        <link rel="stylesheet" href="./css/style.css">
    </head>
    <body>
        <header>
            <h1><a href="/">商品レビューページ</a></h1>
        </header>
        <main>
            <h2>レビューを投稿する</h2>
            <form action="/" method="post" class="review-form" novalidate>
                <table>
                    <tr>
                        <td>
                            <h3>お名前<span class="error" id="nameError"></span></h3>
                            <input type="text" name="username">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>ご年齢<span class="error" id="ageError"></span></h3>
                            <input type="text" name="age" id="age">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>評価<span class="error" id="ratingError"></span></h3>
                            <select name="rating" id="rating">
                                <option value="" disabled selected>選択してください</option>
                                <option value="1">評価１</option>
                                <option value="2">評価２</option>
                                <option value="3">評価３</option>
                                <option value="4">評価４</option>
                                <option value="5">評価５</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>レビュー内容<span class="error" id="reasonError"></span></h3>
                            <textarea name="reason"></textarea>
                        </td>
                    </tr>
                </table>
                <button type="submit">投稿</button>
            </form>
        </main>
        <footer>
            <div class="footer-textarea">&copy; hoge.,LTD. all rights reserved</div>
        </footer>
        <script>
            // 投稿ボタンが押された際のバリデーションチェック
            document.querySelector("button[type='submit']").addEventListener("click", (event) => {
                let error = false
                // 各入力項目の取得
                const name      = document.querySelector("input[name='username']")
                const age       = document.querySelector("input[name='age']")
                const rating    = document.querySelector("select[name='rating']")
                const reason    = document.querySelector("textarea[name='reason']")
                // エラー出力位置の取得
                const nameError     = document.querySelector("#nameError")
                const ageError      = document.querySelector("#ageError")
                const ratingError   = document.querySelector("#ratingError")
                const reasonError   = document.querySelector("#reasonError")
                // エラーの初期化
                nameError.innerHTML     = ""
                ageError.innerHTML      = ""
                ratingError.innerHTML   = ""
                reasonError.innerHTML   = ""

                // 名前は記号の入力は受け付けない
                const nameVal = /^[0-9０-９!?_+*'"`#$%&\-^\\@;:,./=~|[\](){}<>！？＿＋＊’”‘＃＄％＆￥－＾￥＠；：，．／＝～｜［］（）｛｝＜＞]+$/;
                if(name.value.match(nameVal) || name.value === "") {
                    nameError.innerHTML = "名前を入力してください"
                    error = true
                }
                // 年齢は数字の入力のみ3桁まで
                const ageVal = /^[0-9]{1,3}$/;
                // 一応120以上は年齢と見なさないようにする
                if(!age.value.match(ageVal) || Number(age.value) >= 120 || age.value === "") {
                    ageError.innerHTML = "年齢を入力してください"
                    error = true
                }
                // 評価が選択されているかチェック
                for(const option of rating.options) {
                    if(option.selected) {
                        if(option.value === "") {
                            ratingError.innerHTML = "評価を選択してください"
                            error = true
                        }
                    }
                }
                // レビュー内容が入力されているかチェック
                if(reason.value === "") {
                    reasonError.innerHTML = "年齢を入力してください"
                    error = true
                }
                // エラーが1つでもある場合はサーバー送信しない
                if(error) event.preventDefault()
            })
        </script>
    </body>
</html>
